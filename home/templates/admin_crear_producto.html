{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Producto - Admin</title>
    <link rel="stylesheet" href="{% static 'styles/main.css' %}">
    <link rel="stylesheet" href="{% static 'styles/admin.css' %}">
</head>
<body>
    <nav class="topbar admin-topbar">
        <div class="topbar-container">
            <div class="logo">
                <a href="{% url 'admin_panel' %}">
                    <img src="{% static 'images/Logoadmin.png' %}" alt="Todo Jardin Logo">
                </a>
                <h1><a href="{% url 'admin_panel' %}">Todo Jardin</a></h1>
            </div>
            <div class="nav-links">
                <div class="admin-dropdown">
                    <a href="{% url 'admin_panel' %}" class="admin-link active">Panel de Administración</a>
                    <div class="admin-dropdown-content">
                        <a href="{% url 'admin_panel' %}">Dashboard</a>
                        <a href="{% url 'admin_pedidos' %}">Pedidos</a>
                        <a href="{% url 'admin_productos' %}">Productos</a>
                        <a href="{% url 'admin_usuarios' %}">Usuarios</a>
                        <a href="{% url 'admin_configuracion_envio' %}">Configuración Envío</a>
                    </div>
                </div>
            </div>
            <div class="user-circle">
                <a href="{% url 'user' %}" class="user-link">
                    <div class="circle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                </a>
            </div>
        </div>
    </nav>

    <main class="admin-container">
        <h1>Crear Nuevo Producto</h1>
        
        <div class="admin-form">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="nombre">Nombre *</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                
                <div class="form-group">
                    <label for="descripcion">Descripción *</label>
                    <textarea id="descripcion" name="descripcion" rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="precio">Precio (€) *</label>
                    <input type="number" id="precio" name="precio" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="stock">Stock *</label>
                    <input type="number" id="stock" name="stock" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="categoria">Categoría</label>
                    <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                        <select id="categoria" name="categoria" style="flex: 1;">
                            <option value="">Sin categoría</option>
                            {% for categoria in categorias %}
                            <option value="{{ categoria.id }}">{{ categoria.nombre }}</option>
                            {% endfor %}
                        </select>
                        <button type="button" onclick="toggleNewCategory()" class="btn-new-item">+ Nueva</button>
                    </div>
                    <div id="newCategorySection" class="new-category-section" style="display: none;">
                        <label for="nueva_categoria">Nueva Categoría:</label>
                        <input type="text" id="nueva_categoria" name="nueva_categoria" placeholder="Nombre de la nueva categoría">
                        <small style="display: block; margin-top: 0.5rem; color: #1E3A8A;">Si rellenas esto, se creará una nueva categoría</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="marca">Marca</label>
                    <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                        <select id="marca" name="marca" style="flex: 1;">
                            <option value="">Sin marca</option>
                            {% for marca in marcas %}
                            <option value="{{ marca.id }}">{{ marca.nombre }}</option>
                            {% endfor %}
                        </select>
                        <button type="button" onclick="toggleNewBrand()" class="btn-new-item">+ Nueva</button>
                    </div>
                    <div id="newBrandSection" class="new-brand-section" style="display: none;">
                        <label for="nueva_marca">Nueva Marca:</label>
                        <input type="text" id="nueva_marca" name="nueva_marca" placeholder="Nombre de la nueva marca">
                        <small style="display: block; margin-top: 0.5rem; color: #1E3A8A;">Si rellenas esto, se creará una nueva marca</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="color">Color</label>
                    <input type="text" id="color" name="color" placeholder="Ej: Verde, Rojo, Azul">
                </div>
                
                <div class="form-group">
                    <label for="material">Material</label>
                    <input type="text" id="material" name="material" placeholder="Ej: Algodón, Plástico, Madera">
                </div>
                
                <div class="form-group">
                    <label for="imagen">Imagen del Producto</label>
                    <input type="file" id="imagen" name="imagen" accept="image/*" class="file-input" onchange="previewImage(event)">
                    <small class="form-text">Formatos aceptados: JPG, PNG, GIF (máx. 5MB)</small>
                    <div id="imagePreview" style="display: none;">
                        <p>Imagen seleccionada:</p>
                        <img id="preview">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="es_destacado" name="es_destacado">
                        <span class="checkmark"></span>
                        <span class="checkbox-label">Producto Destacado</span>
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Crear Producto</button>
                    <a href="{% url 'admin_productos' %}" class="btn-cancel">Cancelar</a>
                </div>
            </form>
        </div>
    </main>
    <script>
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('preview');
                    const previewContainer = document.getElementById('imagePreview');
                    preview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        }
        
        function toggleNewCategory() {
            const section = document.getElementById('newCategorySection');
            if (section.style.display === 'none') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
                document.getElementById('nueva_categoria').value = '';
            }
        }
        
        function toggleNewBrand() {
            const section = document.getElementById('newBrandSection');
            if (section.style.display === 'none') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
                document.getElementById('nueva_marca').value = '';
            }
        }
    </script>
</body>
</html>
