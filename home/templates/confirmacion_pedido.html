{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido Confirmado - Todo Jardin</title>
    <link rel="stylesheet" href="{% static 'styles/main.css' %}">
    <link rel="stylesheet" href="{% static 'styles/confirmacion.css' %}">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="topbar">
        <div class="topbar-container">
            <div class="logo">
                <a href="{% url 'mainPage' %}">
                    <img src="{% static 'images/Logo.png' %}" alt="Todo Jardin Logo">
                </a>
                <h1><a href="{% url 'mainPage' %}">Todo Jardin</a></h1>
            </div>
            <div class="nav-links">
                <a href="{% url 'productos' %}">Productos</a>
                <a href="{% url 'terminos' %}">Términos y Condiciones</a>
            </div>
            <!-- Buscador en navegación -->
            <div class="search-bar-nav">
                <form method="GET" action="{% url 'productos' %}" class="search-form-nav">
                    <input type="text" name="buscar" placeholder="Buscar productos..." class="search-input-nav" value="">
                    <button type="submit" class="search-btn-nav">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </form>
            </div>
            <div class="user-circle">
                <a href="{% url 'user' %}" class="user-link">
                    <div class="circle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                </a>
            </div>
        </div>
    </nav>

    <main class="confirmacion-container">
        <div class="confirmacion-card">
            <div class="icono-exito">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
            
            <h1>¡Compra Exitosa!</h1>
            <p class="mensaje-exito">Tu pedido ha sido procesado correctamente</p>
            
            {% if fue_invitado %}
            <div class="invitado-info" style="background-color: #e3f2fd; border: 2px solid #2196f3; border-radius: 8px; padding: 15px; margin: 20px 0; display: flex; align-items: center; gap: 12px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="11" fill="none" stroke="#2196f3" stroke-width="2"></circle>
                    <polygon points="10.8,4 11.6,15.2 12.4,15.2 13.2,4" fill="#2196f3"></polygon>
                    <rect x="11.4" y="17.6" width="1.2" height="1.2" fill="#2196f3"></rect>
                </svg>
                <div>
                    <strong style="color: #1976d2;">Pedido realizado como invitado</strong>
                    <p style="margin: 5px 0 0 0; color: #555;">¡Gracias por tu compra! Para acceder al historial de pedidos y otras ventajas, <a href="{% url 'registro' %}" style="color: #1976d2; text-decoration: underline;">crea una cuenta</a>.</p>
                </div>
            </div>
            {% endif %}
            
            <div class="pedido-info">
                <div class="info-grupo">
                    <span class="info-label">Número de Pedido:</span>
                    <span class="info-valor pedido-numero">{{ pedido.numero_pedido }}</span>
                </div>
                <div class="info-grupo">
                    <span class="info-label">Fecha:</span>
                    <span class="info-valor">{{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="info-grupo">
                    <span class="info-label">Estado:</span>
                    <span class="badge-estado">{{ pedido.get_estado_display }}</span>
                </div>
            </div>

            <div class="detalles-pedido">
                <h2>Detalles del Pedido</h2>
                
                <div class="productos-pedido">
                    {% for item in items %}
                    <div class="producto-item">
                        <div class="producto-info">
                            <span class="producto-nombre">{{ item.producto.nombre }}</span>
                            <span class="producto-cantidad">x{{ item.cantidad }}</span>
                        </div>
                        <span class="producto-precio">€{{ item.total }}</span>
                    </div>
                    {% endfor %}
                </div>

                <div class="totales-pedido">
                    <div class="total-linea">
                        <span>Subtotal:</span>
                        <span>€{{ pedido.subtotal }}</span>
                    </div>
                    <div class="total-linea">
                        <span>IVA (21%):</span>
                        <span>€{{ pedido.impuestos }}</span>
                    </div>
                    <div class="total-linea">
                        <span>Envío:</span>
                        <span>{% if pedido.coste_entrega == 0 %}GRATIS{% else %}€{{ pedido.coste_entrega }}{% endif %}</span>
                    </div>
                    {% if pedido.descuento > 0 %}
                    <div class="total-linea descuento">
                        <span>Descuento:</span>
                        <span>-€{{ pedido.descuento }}</span>
                    </div>
                    {% endif %}
                    <div class="total-linea total-final">
                        <span>Total:</span>
                        <span>€{{ pedido.total }}</span>
                    </div>
                </div>
            </div>

            <div class="envio-info">
                <h3>Información de Envío</h3>
                {% if pedido.direccion_envio and pedido.direccion_envio != ', , ' %}
                <p><strong>Dirección:</strong> {{ pedido.direccion_envio }}</p>
                {% endif %}
                <p><strong>Teléfono:</strong> {{ pedido.telefono }}</p>
                <p><strong>Método de Pago:</strong> {{ pedido.get_metodo_pago_display }}</p>
            </div>
            
            {% if pedido.metodo_pago == 'reembolso' %}
            <div class="reembolso-banner">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <div>
                    <strong>    Pago Contra Reembolso</strong>
                    <p>Pagarás en efectivo al recibir tu pedido. El repartidor te entregará el paquete y cobrará el importe total de <strong>€{{ pedido.total }}</strong>.</p>
                </div>
            </div>
            {% endif %}

            
            {% if pedido.estado == 'confirmado' %}
            <div class="nota-info">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="11" fill="none" stroke="currentColor" stroke-width="2"></circle>
                    <polygon points="10.8,4 11.6,15.2 12.4,15.2 13.2,4"></polygon>
                    <rect x="11.4" y="17.6" width="1.2" height="1.2"></rect>
                </svg>
                
                <p>Tu pedido ha sido confirmado exitosamente. Recibirás actualizaciones sobre el estado de tu envío.</p>
            </div>
            {% endif %}

            {% if pedido.estado == 'pendiente' %}
            <div class="alerta-confirmacion">
                <p><strong>⏳ Pedido Pendiente de Confirmación</strong></p>
                <p>Tu pedido aún no ha sido confirmado. <strong>Revisa tu correo electrónico</strong> y haz clic en el enlace de confirmación para que podamos procesar tu pedido y actualizar el inventario.</p>
                <p style="margin-top: 10px; font-size: 0.9rem;">Si no encuentras el correo, revisa tu carpeta de spam o correo no deseado.</p>
            </div>
            {% endif %}

            <div class="acciones">
                <a href="{% url 'mainPage' %}" class="btn-inicio">Volver al Inicio</a>
                <a href="{% url 'productos' %}" class="btn-productos">Seguir Comprando</a>
            </div>
        </div>
    </main>
</body>
</html>
